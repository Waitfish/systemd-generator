name: Release

on:
  push:
    tags:
      - 'v*'

env:
  CARGO_TERM_COLOR: always

jobs:
  build-and-release:
    name: Build and Release
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Install Rust
        uses: dtolnay/rust-toolchain@stable
      
      - name: Build release binary
        run: |
          cargo build --release --verbose
          strip target/release/systemd-generator || true
      
      - name: Create Release
        uses: softprops/action-gh-release@v2
        with:
          files: target/release/systemd-generator
          body: |
            ## systemd-generator ${{ github.ref_name }}
            
            å¿«é€Ÿç”Ÿæˆ Linux systemd service é…ç½®æ–‡ä»¶çš„å‘½ä»¤è¡Œå·¥å…·ã€‚
            
            ### ğŸ“¦ å®‰è£…
            
            ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶ï¼š
            ```bash
            wget https://github.com/${{ github.repository }}/releases/download/${{ github.ref_name }}/systemd-generator
            chmod +x systemd-generator
            sudo mv systemd-generator /usr/local/bin/
            ```
            
            æˆ–ä½¿ç”¨ Cargo å®‰è£…ï¼š
            ```bash
            cargo install systemd-generator
            ```
            
            ### ğŸš€ ä½¿ç”¨
            ```bash
            systemd-generator --name myapp --exec /usr/bin/myapp
            ```
            
            æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹ [README](https://github.com/${{ github.repository }}#readme)
          draft: false
          prerelease: false
